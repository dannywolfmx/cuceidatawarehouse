<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/vaadin-upload/vaadin-upload.html">
<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="">

<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animation.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../../bower_components/iron-localstorage/iron-localstorage.html">


<link rel="import" href="../login-component/login-panel.html">
<link rel="import" href="../login-component/registro-panel.html">

<script src="/socket.io/socket.io.js"></script>

<dom-module id="interface-grafica-app">
  <template>

    <style>
       :host {
        display: block;
      }
      
      paper-drawer-panel {
        --paper-drawer-panel-left-drawer-container: {
          background-color: #333333;
        }
        ;
      }
      
      #lista-archivos {

        background-color: #333333;
        display: block;
        margin: 16px;
        padding: 16px;
        --paper-card-header-text:{
          color:white;
        }
      }
      
      paper-menu {
        --paper-menu-background-color: {
          background-color: transparent;
        }
        --paper-menu: {}
      }
      
      paper-item:hover {
        opacity: 1;
        background-color: #555555;
      }
      
      paper-item {
        color: #fff;
        opacity: 0.7;
      }
      
      login-panel,
      registro-panel {
        display: block;
        margin: 0 auto;
        max-width: 500px;
      }
    </style>


  <iron-localstorage name="token"
    value="{{token}}"
  ></iron-localstorage>


    <paper-drawer-panel hidden$="[[!uregistrado]]">
      <paper-header-panel drawer>
        <paper-toolbar></paper-toolbar>
        <paper-menu>
          <paper-item>Login</paper-item>
          <paper-item>Subir archivos</paper-item>
        </paper-menu>

      </paper-header-panel>
      <paper-header-panel main>
        <paper-toolbar></paper-toolbar>

        <vaadin-upload i18n="[[i18n]]" on-upload-response="uploadresponse" on-upload-before="agregarheader" id="fileupdate" name="sampleFile"
          target="/upload" method="POST"></vaadin-upload>

        <paper-card heading="Lista archivos" id="lista-archivos" image="" elevation="1" animated-shadow="false">
          <template is="dom-repeat" items="[[listaarchivos]]">
            <paper-item>
              [[item]]
            </paper-item>
          </template>
        </paper-card>

      </paper-header-panel>
    </paper-drawer-panel>



    <div hidden$="[[uregistrado]]">
      <paper-tabs selected="{{loginPanel}}">
        <paper-tab>Iniciar</paper-tab>
        <paper-tab>Registrarse</paper-tab>
      </paper-tabs>

      <neon-animated-pages selected=[[loginPanel]]>
        <login-panel usuario="{{usuario}}" token={{token}}></login-panel>
        <registro-panel usuario="{{usuario}}" token={{token}}></registro-panel>
      </neon-animated-pages>

    </div>



  </template>

  <script>

  </script>
  <script>
    Polymer({

      is: 'interface-grafica-app',

      properties: {
        datos: {
          type: Array,
          value: []
        },
        loginPanel: {
          type: Boolean,
          value: 0
        },
        usuario: Object,
        token: {
          type: String,
          value: "",
          observer: "registrado"
        },
        uregistrado: {
          type: Boolean,
          value: false
        },
        listaarchivos: {
          type: Array,
          value: []
        }
        ,
        i18n: {
          type: Object,
          value: {
            dropFiles: {
              one: 'Suelta el archivo aqui...',
              many: 'Suelta los archivos aqui...'
            },
            addFiles: {
              one: 'Selecciona un archivo',
              many: 'Selecciona los archivos'
            },
            cancel: 'Cancelar',
            error: {
              tooManyFiles: 'Demaciados archivos',
              fileIsTooBig: 'Archivo demaciado grande',
              incorrectFileType: 'Tipo incorrecto de archivos'
            },
            uploading: {
              status: {
                connecting: 'Conectando',
                stalled: 'Stalled.',
                processing: 'Procesando archivos...'
              },
              remainingTime: {
                prefix: 'Tiempo reamanente: ',
                unknown: 'Tiempo desconocido'
              },
              error: {
                serverUnavailable: 'Servidor no disponible',
                unexpectedServerError: 'Error desconocido en servidor',
                forbidden: 'Acceso prohibido'
              }
            },
            units: {
              size: ['B', 'kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']
            },
            formatSize: function (bytes) {
              // returns the size followed by the best suitable unit
            },
            formatTime: function (seconds, [secs, mins, hours]) {
              // returns a 'HH:MM:SS' string
            }
          }
        }


      },
      attached: function () {
        self = this

        document.querySelector('vaadin-upload').addEventListener('upload-response', function (e) {
          //console.log(e.detail.xhr.response); 
          self.set("datos", e.detail.xhr.response)
        })

        document.querySelector('vaadin-upload').addEventListener('upload-response', function (e) {
          //console.log(e.detail.xhr.response); 
          self.set("datos", e.detail.xhr.response)
        })
        var socket = io.connect('http://localhost:3001');
        socket.on('news', function (data) {
          console.log(data);
          self.set("datos", data)
        });
      },
      registrado: function () {
        this.set("uregistrado", (this.token.length > 0));
      },
      agregarheader: function () {
        this.$.fileupdate.headers = {
          Authorization: "Bear " + this.token
        }
      },
      uploadresponse: function (e) {
        this.push("listaarchivos", e.detail.file.name);
      }


    });
  </script>
</dom-module>